@model IEnumerable<LibraryManagementSystem.Models.Book>
@{
    Layout = "_Layout";
}
<h2>Books</h2>

<button id="btnAdd" class="btn btn-primary">Add Book</button>

<table class="table" id="booksTable">
    <thead>
        <tr><th>Title</th><th>Author</th><th>Genre</th><th>Price</th><th>Actions</th></tr>
    </thead>
    <tbody>
        @foreach (var b in Model)
        {
            <tr data-id="@b.BookId">
                <td>@b.Title</td>
                <td>@b.Author?.Name</td>
                <td>@b.Genre?.Name</td>
                <td>@b.Price</td>
                <td>
                    <button class="btn btn-sm btn-warning btn-edit" data-id="@b.BookId">Edit</button>
                    <button class="btn btn-sm btn-danger btn-delete" data-id="@b.BookId">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- modal for create/edit -->
<div id="modalHolder"></div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function loadModal(url) {
            $.get(url).done(function (html) {
                $('#modalHolder').html(html);
                $('#entityModal').modal('show');
                bindForm();
            });
        }

        function bindForm() {
            $('#entityForm').on('submit', function (e) {
                e.preventDefault();
                var form = $(this);
                var url = form.attr('action');
                var method = form.attr('method');
                var data = form.serialize();
                $.ajax({
                    url: url,
                    type: method,
                    data: data
                }).done(function () {
                    location.reload();
                }).fail(function (xhr) {
                    alert('Error: ' + xhr.statusText);
                });
            });
        }

        $(function () {
            $('#btnAdd').click(function () {
                loadModal('@Url.Action("Create","Books")');
            });

            $('.btn-edit').click(function () {
                var id = $(this).data('id');
                loadModal('@Url.Action("Edit","Books")/' + id);
            });

            $('.btn-delete').click(function () {
                if (!confirm('Delete this book?')) return;
                var id = $(this).data('id');
                $.post('@Url.Action("Delete","Books")', { id: id })
                 .done(function () { location.reload(); })
                 .fail(function () { alert('Delete failed'); });
            });
        });
    </script>
}
